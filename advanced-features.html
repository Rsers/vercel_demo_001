<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel é«˜çº§åŠŸèƒ½æ¼”ç¤º</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            margin-top: 30px;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: bold;
            font-size: 1.1em;
        }

        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }

        .result-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .log-entry {
            border-bottom: 1px solid #eee;
            padding: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #666;
            font-size: 0.8em;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center text-white mb-5">ğŸš€ Vercel é«˜çº§åŠŸèƒ½æ¼”ç¤º</h1>

        <div class="row">
            <!-- Edge Functions -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">ğŸŒ</div>
                            <h5 class="mb-0">Edge Functions</h5>
                            <small>è¾¹ç¼˜è®¡ç®—</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            åœ¨è¾¹ç¼˜èŠ‚ç‚¹è¿è¡Œçš„å‡½æ•°ï¼Œå»¶è¿Ÿæ›´ä½ï¼Œæ€§èƒ½æ›´å¥½ã€‚
                            æ”¯æŒåœ°ç†ä½ç½®æ£€æµ‹å’Œè¾¹ç¼˜ç¼“å­˜ã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="testEdgeFunction()">
                            æµ‹è¯• Edge Function
                        </button>
                        <div id="edge-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Middleware -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">ğŸ”„</div>
                            <h5 class="mb-0">Middleware</h5>
                            <small>è¯·æ±‚ä¸­é—´ä»¶</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            åœ¨è¯·æ±‚åˆ°è¾¾é¡µé¢/API ä¹‹å‰è¿è¡Œçš„ä»£ç ã€‚
                            æ”¯æŒè®¤è¯ã€A/Bæµ‹è¯•ã€é‡å®šå‘ç­‰åŠŸèƒ½ã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="testMiddleware()">
                            æµ‹è¯• Middleware
                        </button>
                        <div id="middleware-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Cron Jobs -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">â°</div>
                            <h5 class="mb-0">Cron Jobs</h5>
                            <small>å®šæ—¶ä»»åŠ¡</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç”¨äºæ•°æ®æ¸…ç†ã€å¤‡ä»½ã€
                            å‘é€é€šçŸ¥ç­‰è‡ªåŠ¨åŒ–æ“ä½œã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="testCronJob()">
                            æµ‹è¯• Cron Job
                        </button>
                        <div id="cron-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Webhooks -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">ğŸ”—</div>
                            <h5 class="mb-0">Webhooks</h5>
                            <small>äº‹ä»¶é©±åŠ¨</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            äº‹ä»¶é©±åŠ¨çš„å¤„ç†æœºåˆ¶ï¼Œæ¥æ”¶æ¥è‡ªå„ç§æœåŠ¡çš„äº‹ä»¶é€šçŸ¥ï¼Œ
                            å®ç°è‡ªåŠ¨åŒ–ä¸šåŠ¡æµç¨‹ã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="testWebhook()">
                            æµ‹è¯• Webhook
                        </button>
                        <div id="webhook-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- ç›‘æ§é¢æ¿ -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">ğŸ“Š</div>
                            <h5 class="mb-0">ç›‘æ§é¢æ¿</h5>
                            <small>å®æ—¶ç›‘æ§</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            æŸ¥çœ‹æ‰€æœ‰åŠŸèƒ½çš„æ‰§è¡Œæ—¥å¿—å’ŒçŠ¶æ€ã€‚
                            å®æ—¶ç›‘æ§ç³»ç»Ÿè¿è¡Œæƒ…å†µã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="showMonitoring()">
                            æŸ¥çœ‹ç›‘æ§é¢æ¿
                        </button>
                        <div id="monitoring-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½å¯¹æ¯” -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header">
                        <div class="text-center">
                            <div class="feature-icon">ğŸ“‹</div>
                            <h5 class="mb-0">åŠŸèƒ½å¯¹æ¯”</h5>
                            <small>Vercel vs Supabase</small>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            å¯¹æ¯” Vercel å’Œ Supabase çš„åŠŸèƒ½å·®å¼‚ï¼Œ
                            äº†è§£å„è‡ªçš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ã€‚
                        </p>
                        <button class="btn btn-custom w-100" onclick="showComparison()">
                            æŸ¥çœ‹åŠŸèƒ½å¯¹æ¯”
                        </button>
                        <div id="comparison-result" class="result-area" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¨å±€æ—¥å¿—åŒºåŸŸ -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ğŸ“ æ‰§è¡Œæ—¥å¿—</h5>
            </div>
            <div class="card-body">
                <div id="global-logs">
                    <p class="text-muted">æš‚æ— æ‰§è¡Œæ—¥å¿—</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€æ—¥å¿—è®°å½•
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('global-logs');
            const timestamp = new Date().toLocaleTimeString();

            // ç§»é™¤é»˜è®¤æç¤º
            const defaultP = logsContainer.querySelector('.text-muted');
            if (defaultP) defaultP.remove();

            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="status-badge status-${type}">${type.toUpperCase()}</span>
                ${message}
            `;

            logsContainer.insertBefore(logEntry, logsContainer.firstChild);

            // é™åˆ¶æ—¥å¿—æ•°é‡
            const logs = logsContainer.querySelectorAll('.log-entry');
            if (logs.length > 20) {
                logs[logs.length - 1].remove();
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = content;
        }

        // æµ‹è¯• Edge Function
        async function testEdgeFunction() {
            addLog('å¼€å§‹æµ‹è¯• Edge Function...', 'info');

            try {
                const response = await fetch('/api/edge-simple');
                const data = await response.json();

                const resultHtml = `
                    <div class="status-badge status-success">SUCCESS</div>
                    <h6>åœ°ç†ä½ç½®ä¿¡æ¯:</h6>
                    <ul>
                        <li>å›½å®¶: ${data.location.country}</li>
                        <li>åŸå¸‚: ${data.location.city}</li>
                        <li>åœ°åŒº: ${data.location.region}</li>
                        <li>æ—¶åŒº: ${data.location.timezone}</li>
                    </ul>
                    <h6>è¾¹ç¼˜è®¡ç®—ç‰¹æ€§:</h6>
                    <ul>
                        <li>è¿è¡Œæ—¶: ${data.edge.runtime}</li>
                        <li>å»¶è¿Ÿ: ${data.edge.latency}</li>
                        <li>å¤„ç†æ—¶é—´: ${data.processingTime}ms</li>
                    </ul>
                    <p><strong>æ¶ˆæ¯:</strong> ${data.message}</p>
                `;

                showResult('edge-result', resultHtml, 'success');
                addLog('Edge Function æµ‹è¯•æˆåŠŸ', 'success');

            } catch (error) {
                const resultHtml = `
                    <div class="status-badge status-error">ERROR</div>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
                showResult('edge-result', resultHtml, 'error');
                addLog(`Edge Function æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• Middleware
        async function testMiddleware() {
            addLog('å¼€å§‹æµ‹è¯• Middleware...', 'info');

            try {
                // è°ƒç”¨ Middleware æ¼”ç¤º API
                const response = await fetch('/api/middleware-demo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token' // æ¨¡æ‹Ÿè®¤è¯
                    }
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message);
                }

                const resultHtml = `
                    <div class="status-badge status-success">SUCCESS</div>
                    <h6>Middleware åŠŸèƒ½æ¼”ç¤º:</h6>
                    <div class="mb-3">
                        <strong>è‡ªå®šä¹‰å¤´éƒ¨:</strong>
                        <ul>
                            ${Object.entries(data.middleware.customHeaders).map(([key, value]) =>
                    `<li>${key}: ${value}</li>`
                ).join('')}
                        </ul>
                    </div>
                    <div class="mb-3">
                        <strong>åœ°ç†ä½ç½®:</strong>
                        <ul>
                            <li>å›½å®¶: ${data.middleware.locationInfo.country}</li>
                            <li>åŸå¸‚: ${data.middleware.locationInfo.city}</li>
                            <li>åœ°åŒº: ${data.middleware.locationInfo.region}</li>
                        </ul>
                    </div>
                    <div class="mb-3">
                        <strong>A/B æµ‹è¯•:</strong> ${data.middleware.abTest.message}
                    </div>
                    <div class="mb-3">
                        <strong>è®¤è¯çŠ¶æ€:</strong> ${data.middleware.authentication.message}
                    </div>
                    <div class="mb-3">
                        <strong>å®‰å…¨å¤´éƒ¨:</strong>
                        <ul>
                            ${Object.entries(data.middleware.security).map(([key, value]) =>
                    `<li>${key}: ${value}</li>`
                ).join('')}
                        </ul>
                    </div>
                `;

                showResult('middleware-result', resultHtml, 'success');
                addLog('Middleware æµ‹è¯•æˆåŠŸ', 'success');

            } catch (error) {
                const resultHtml = `
                    <div class="status-badge status-error">ERROR</div>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
                showResult('middleware-result', resultHtml, 'error');
                addLog(`Middleware æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• Cron Job
        async function testCronJob() {
            addLog('å¼€å§‹æµ‹è¯• Cron Job...', 'info');

            try {
                // æ³¨æ„ï¼šå®é™…çš„ Cron Job åªèƒ½ç”± Vercel å®šæ—¶è§¦å‘
                // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿè°ƒç”¨
                const response = await fetch('/api/cron-cleanup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-vercel-cron': 'true' // æ¨¡æ‹Ÿ Cron è¯·æ±‚
                    }
                });

                const data = await response.json();

                const resultHtml = `
                    <div class="status-badge status-success">SUCCESS</div>
                    <h6>Cron Job æ‰§è¡Œç»“æœ:</h6>
                    <p><strong>æ¶ˆæ¯:</strong> ${data.message}</p>
                    <h6>ä»»åŠ¡æ‰§è¡Œæƒ…å†µ:</h6>
                    <ul>
                        <li>æ€»ä»»åŠ¡æ•°: ${data.results.summary.totalTasks}</li>
                        <li>æˆåŠŸä»»åŠ¡: ${data.results.summary.successfulTasks}</li>
                        <li>å¤±è´¥ä»»åŠ¡: ${data.results.summary.failedTasks}</li>
                        <li>æ€»æ‰§è¡Œæ—¶é—´: ${data.results.summary.totalTime}ms</li>
                    </ul>
                    <h6>è¯¦ç»†ä»»åŠ¡:</h6>
                    ${data.results.tasks.map(task => `
                        <div class="mb-1">
                            <strong>${task.name}:</strong> 
                            <span class="status-badge status-${task.status}">${task.status}</span>
                            ${task.details ? `<br><small>${task.details.message}</small>` : ''}
                        </div>
                    `).join('')}
                `;

                showResult('cron-result', resultHtml, 'success');
                addLog('Cron Job æµ‹è¯•æˆåŠŸ', 'success');

            } catch (error) {
                const resultHtml = `
                    <div class="status-badge status-error">ERROR</div>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
                showResult('cron-result', resultHtml, 'error');
                addLog(`Cron Job æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯• Webhook
        async function testWebhook() {
            addLog('å¼€å§‹æµ‹è¯• Webhook...', 'info');

            try {
                const testEvents = [
                    {
                        type: 'user_registration',
                        source: 'test',
                        data: {
                            userId: 123,
                            name: 'æµ‹è¯•ç”¨æˆ·',
                            email: 'test@example.com'
                        }
                    },
                    {
                        type: 'payment_success',
                        source: 'test',
                        data: {
                            orderId: 'ORDER-001',
                            email: 'customer@example.com',
                            amount: 99.99,
                            items: [{ id: 1, name: 'æµ‹è¯•å•†å“' }]
                        }
                    }
                ];

                const results = [];

                for (const event of testEvents) {
                    const response = await fetch('/api/webhook-handler', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-webhook-source': 'test',
                            'x-webhook-signature': 'test-signature'
                        },
                        body: JSON.stringify(event)
                    });

                    const data = await response.json();
                    results.push({
                        event: event.type,
                        success: data.success,
                        result: data.result
                    });
                }

                const resultHtml = `
                    <div class="status-badge status-success">SUCCESS</div>
                    <h6>Webhook æµ‹è¯•ç»“æœ:</h6>
                    ${results.map(result => `
                        <div class="mb-3">
                            <strong>äº‹ä»¶ç±»å‹:</strong> ${result.event}<br>
                            <strong>å¤„ç†çŠ¶æ€:</strong> 
                            <span class="status-badge status-${result.success ? 'success' : 'error'}">
                                ${result.success ? 'SUCCESS' : 'FAILED'}
                            </span><br>
                            <strong>å¤„ç†ç»“æœ:</strong> ${result.result.message}
                            <h6>æ‰§è¡Œçš„æ“ä½œ:</h6>
                            <ul>
                                ${result.result.actions.map(action =>
                    `<li>${action.name}: ${action.result.message}</li>`
                ).join('')}
                            </ul>
                        </div>
                    `).join('')}
                `;

                showResult('webhook-result', resultHtml, 'success');
                addLog('Webhook æµ‹è¯•æˆåŠŸ', 'success');

            } catch (error) {
                const resultHtml = `
                    <div class="status-badge status-error">ERROR</div>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
                showResult('webhook-result', resultHtml, 'error');
                addLog(`Webhook æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºç›‘æ§é¢æ¿
        function showMonitoring() {
            const resultHtml = `
                <div class="status-badge status-info">INFO</div>
                <h6>ç›‘æ§é¢æ¿åŠŸèƒ½:</h6>
                <ul>
                    <li>å®æ—¶æ—¥å¿—ç›‘æ§</li>
                    <li>æ€§èƒ½æŒ‡æ ‡è¿½è¸ª</li>
                    <li>é”™è¯¯ç‡ç»Ÿè®¡</li>
                    <li>ç”¨æˆ·è¡Œä¸ºåˆ†æ</li>
                </ul>
                <p><strong>æç¤º:</strong> è®¿é—® <a href="analytics-dashboard.html" target="_blank">ç›‘æ§ä»ªè¡¨æ¿</a> æŸ¥çœ‹è¯¦ç»†ç›‘æ§æ•°æ®ã€‚</p>
            `;
            showResult('monitoring-result', resultHtml, 'info');
            addLog('æ˜¾ç¤ºç›‘æ§é¢æ¿ä¿¡æ¯', 'info');
        }

        // æ˜¾ç¤ºåŠŸèƒ½å¯¹æ¯”
        function showComparison() {
            const resultHtml = `
                <div class="status-badge status-info">INFO</div>
                <h6>Vercel vs Supabase åŠŸèƒ½å¯¹æ¯”:</h6>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>åŠŸèƒ½</th>
                            <th>Vercel</th>
                            <th>Supabase</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>è¾¹ç¼˜è®¡ç®—</td>
                            <td><span class="status-badge status-success">âœ…</span></td>
                            <td><span class="status-badge status-error">âŒ</span></td>
                        </tr>
                        <tr>
                            <td>å®šæ—¶ä»»åŠ¡</td>
                            <td><span class="status-badge status-success">âœ…</span></td>
                            <td><span class="status-badge status-error">âŒ</span></td>
                        </tr>
                        <tr>
                            <td>ä¸­é—´ä»¶</td>
                            <td><span class="status-badge status-success">âœ…</span></td>
                            <td><span class="status-badge status-error">âŒ</span></td>
                        </tr>
                        <tr>
                            <td>å®æ—¶åŠŸèƒ½</td>
                            <td><span class="status-badge status-error">âŒ</span></td>
                            <td><span class="status-badge status-success">âœ…</span></td>
                        </tr>
                        <tr>
                            <td>è®¤è¯ç³»ç»Ÿ</td>
                            <td><span class="status-badge status-info">åŸºç¡€</span></td>
                            <td><span class="status-badge status-success">å®Œæ•´</span></td>
                        </tr>
                    </tbody>
                </table>
            `;
            showResult('comparison-result', resultHtml, 'info');
            addLog('æ˜¾ç¤ºåŠŸèƒ½å¯¹æ¯”ä¿¡æ¯', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addLog('é¡µé¢åŠ è½½å®Œæˆï¼ŒVercel é«˜çº§åŠŸèƒ½æ¼”ç¤ºå°±ç»ª', 'success');
        });
    </script>
</body>

</html>